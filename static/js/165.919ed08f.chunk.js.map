{"version":3,"file":"static/js/165.919ed08f.chunk.js","mappings":"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","sources":["../../../../shopy/shopy-salejs/src/order/buttons.tsx","../../../../shopy/shopy-salejs/src/order/utils.ts","../../../../shopy/shopy-salejs/src/order/views.List.tsx"],"sourcesContent":["import * as React from 'react';\nimport { LinkProps } from 'react-router-dom';\n\nimport type { TOrder, TOrderInstance } from './utils';\n\nimport Staff from '@miq/staffjs';\nimport { Button, ConfirmButton, Icons } from '@miq/componentjs';\n\nexport const OrderMarkDelivredButton = ({\n  instance,\n  ...props\n}: {\n  instance: TOrderInstance;\n  icon?: boolean;\n  onSuccess: (res?: any) => void;\n  onFailure?: (res?: any) => void;\n}) => {\n  return (\n    <ConfirmButton\n      renderHeader={() => <div className=\"text-md p-1\">Le client a t'il re√ßu le produit?</div>}\n      renderFooter={({ setOpen }) => (\n        <div className=\"d-flex justify-content-between align-items-center\">\n          <Button onClick={() => setOpen(false)}>Pas encore</Button>\n\n          <Button\n            onClick={() =>\n              instance\n                .mark_delivered()\n                .then((r) => {\n                  props?.onSuccess?.(r);\n                  // setOpen(false);\n                })\n                .catch((err) => {\n                  props?.onFailure?.(err);\n                })\n            }\n            className=\"btn-primary fw-bold\"\n          >\n            Oui\n          </Button>\n        </div>\n      )}\n      render={() => <div className=\"p-3\"></div>}\n      className=\"btn-primary btn-md fw-bold w-50 d-flex align-items-center justify-content-center\"\n    >\n      {instance?.is_delivered ? <Icons.Truck /> : <Icons.TruckOff />}\n      {!props?.icon && <span className=\"ms-1\">Confirmer la livraison</span>}\n    </ConfirmButton>\n  );\n};\n\nexport const OrderUpdateLink = (props: Omit<LinkProps, 'to'> & { instance: TOrder | TOrderInstance }) => (\n  <Staff.Link\n    title={`Modifier cette commande`}\n    {...props}\n    to={`/staff/sales/orders/${props.instance.slug}/`}\n    requiredPerms={['sales.change_order']}\n  >\n    {props.children}\n  </Staff.Link>\n);\n","import type { TOrderItem } from '../cart';\nimport type { TCustomer } from '../customer';\nimport type { TPriceData } from '@shopy/storejs';\nimport type { TDiscount } from '../discount/types';\n\nimport { getStaffModel, StaffService } from '@miq/staffjs';\n\nconst timeout = 5000;\n\nexport type TOrder = {\n  slug?: string;\n  transaction_id?: string;\n  customer?: string;\n  customer_name?: string;\n  customer_data?: TCustomer;\n  //   notes?: string;\n  is_delivered?: boolean;\n  dt_delivered?: string;\n\n  items?: TOrderItem[];\n  items_count?: number;\n  discounts?: TDiscount[];\n  //   products?: string[];\n\n  //   is_placed?: boolean;\n  subtotal?: TPriceData;\n  total?: TPriceData;\n\n  created?: string;\n  updated?: string;\n};\n\nclass OrderService extends StaffService<TOrder> {\n  mark_delivered() {\n    if (this.data?.is_delivered) return Promise.resolve({ data: this.data });\n    return this.post(`${this._path}deliver/`, {}, { timeout });\n  }\n\n  postDiscount(values: Exclude<TDiscount, 'slug' | 'amt_data'>) {\n    return this.post(`${this._path}discount/`, values);\n  }\n\n  get deliveredDt() {\n    return this.formatDt(this.data?.dt_delivered);\n  }\n  get updatedDt() {\n    return this.formatDt(this.data?.updated);\n  }\n  get createdDt() {\n    return this.formatDt(this.data?.created);\n  }\n\n  formatDt(dt?: string) {\n    if (!dt) return null;\n    return new Date(dt).toLocaleDateString(undefined, {\n      day: '2-digit',\n      weekday: 'short',\n      month: 'short',\n      year: '2-digit',\n    });\n  }\n}\n\nexport const Order = getStaffModel<TOrder, OrderService>('orders', OrderService);\n\nexport type TOrderInstance = ReturnType<typeof Order>;\n","import * as React from 'react';\n\nimport type { TOrder } from './utils';\nimport type { TSDState } from '@miq/contextjs';\n\nimport Staff from '@miq/staffjs';\nimport { SharedDataCtx } from '@miq/contextjs';\nimport { useDocumentTitle } from '@miq/hookjs';\nimport { ProductPriceDisplay, TPriceData } from '@shopy/storejs';\nimport { Card, Icons, Pagination } from '@miq/componentjs';\n\nimport { Order } from './utils';\nimport { OrderUpdateLink } from './buttons';\nimport { PriceDisplay } from '@shopy/storejs/src/components';\nimport { useSearchParams } from 'react-router-dom';\nimport { getCN } from '@miq/utiljs';\n\ntype OrderViewResponse = TSDState<{\n  orders: TOrder[];\n  pagination: any;\n  total: {\n    amount: TPriceData;\n    count: number;\n  };\n  top_cats: { product__category__slug: string; product__category__name: string; total: number }[];\n}>;\n\nexport default function OrderListView() {\n  useDocumentTitle('Orders - Sales');\n\n  const ctx = React.useContext<OrderViewResponse>(SharedDataCtx);\n  const { amount, count } = ctx.total || {};\n\n  return (\n    <Staff.View\n      title=\"Commandes\"\n      back=\"/staff/sales/\"\n      footer={\n        ctx.pagination && (\n          <div>\n            <Pagination {...ctx.pagination} component={Staff.Link} to />\n          </div>\n        )\n      }\n      className=\"sales-orders-view\"\n      headerCN=\"miq-container\"\n    >\n      <div className=\"d-flex\">\n        <PriceDisplay {...amount} />\n        <span className=\"text-muted ms-1\">({count} commandes)</span>\n      </div>\n\n      <div className=\"d-grid grid-lg-6 gap-2\">\n        <div className=\"span-lg-4\">\n          <OrderItems items={ctx.orders} />\n        </div>\n        <div className=\"d-none d-lg-block span-lg-2\">\n          <OrderSummary top_cats={ctx.top_cats} />\n        </div>\n      </div>\n    </Staff.View>\n  );\n}\n\nconst OrderItems = ({ items = [] }: { items: OrderViewResponse['orders'] }) => {\n  if (!items) return null;\n  return (\n    <>\n      {items.map((i) => {\n        const order = Order(i);\n\n        return (\n          <Card\n            // border\n            style={{ marginBottom: 12 }}\n            actions={\n              <div className=\"d-flex\">\n                <OrderUpdateLink instance={order} className=\"btn btn-round btn-primary-3 ms-1\">\n                  <Icons.Edit />\n                </OrderUpdateLink>\n              </div>\n            }\n            title={<div className=\"\">{`${order.customer_name}`}</div>}\n            key={i.slug}\n            className=\"cart-list-item-card mb-1\"\n          >\n            <ul className=\"text-sm\">\n              <li className=\"d-flex align-items-center justify-content-between\">\n                <span className=\"\">{order.items_count} produit(s)</span>\n\n                <span className=\"fw-bold\">\n                  <ProductPriceDisplay retail_price_data={i?.total || i?.subtotal} />\n                </span>\n              </li>\n              <li className=\"text-sm text-muted\">{order.createdDt}</li>\n            </ul>\n          </Card>\n        );\n      })}\n    </>\n  );\n};\n\nconst OrderSummary = (props: { top_cats: OrderViewResponse['top_cats'] }) => {\n  const [params, setParams] = useSearchParams();\n\n  const setCategory = (catSlug: string) => {\n    if (!catSlug || params.get('cat') === catSlug) params.delete('cat');\n    else params.set('cat', catSlug);\n    setParams(params);\n  };\n\n  const { top_cats = [] } = props;\n\n  return (\n    <>\n      {top_cats && (\n        <Staff.Section title=\"Top Categories\">\n          <ol className=\"ps-3\">\n            {top_cats.map((i) => (\n              <li\n                onClick={() => setCategory(i.product__category__slug)}\n                className=\"mb-1\"\n                key={i.product__category__slug}\n              >\n                <span className={getCN(['me-1', i.product__category__slug === params.get('cat') && 'bg-blue-50'])}>\n                  {`${i.product__category__name}`}\n                </span>\n\n                {`(${i.total})`}\n              </li>\n            ))}\n          </ol>\n        </Staff.Section>\n      )}\n    </>\n  );\n};\n"],"names":["OrderMarkDelivredButton","instance","props","renderHeader","className","renderFooter","setOpen","onClick","mark_delivered","then","r","onSuccess","catch","err","onFailure","render","is_delivered","icon","OrderUpdateLink","title","to","slug","requiredPerms","children","OrderService","this","data","Promise","resolve","post","_path","timeout","values","formatDt","dt_delivered","updated","created","dt","Date","toLocaleDateString","undefined","day","weekday","month","year","StaffService","Order","getStaffModel","OrderListView","useDocumentTitle","ctx","React","SharedDataCtx","total","amount","count","back","footer","pagination","component","Staff","headerCN","OrderItems","items","orders","OrderSummary","top_cats","map","i","order","style","marginBottom","actions","customer_name","items_count","retail_price_data","subtotal","createdDt","useSearchParams","params","setParams","catSlug","product__category__slug","get","set","delete","getCN","product__category__name"],"sourceRoot":""}