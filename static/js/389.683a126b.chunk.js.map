{"version":3,"file":"static/js/389.683a126b.chunk.js","mappings":"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","sources":["../../../../shopy/shopy-storejs/src/views.Index.tsx","../../../../.yarn/cache/@babel-runtime-npm-7.17.2-ec60bc114d-a48702d271.zip/node_modules/@babel/runtime/helpers/esm/toArray.js"],"sourcesContent":["import * as React from 'react';\n// import { Chart } from 'react-charts';\n\nimport Staff, { API } from '@miq/staffjs';\nimport { Icons, HorizontalScrollGridLayout, ViewSection, Loading, Button } from '@miq/componentjs';\nimport { SharedDataCtx } from '@miq/contextjs';\n\nimport { getCN, getImgUrl, Response, truncateStr, uuid } from '@miq/utiljs';\nimport { useDocumentTitle, useRequest } from '@miq/hookjs';\nimport { useSearchParams } from 'react-router-dom';\n\n//\n\nconst TopItemCard = (props: any) => {\n  const { data, top } = props;\n\n  return (\n    <div className=\"d-flex align-items-center\" title={`${data?.name}: ${data?.count}`}>\n      {data.img && (\n        <div className=\"bg-gray-100 rounded\" style={{ width: 48, maxWidth: 48 }}>\n          <img\n            src={getImgUrl(data.img)}\n            alt={truncateStr(data?.name, 0, 4)}\n            className=\"rounded\"\n            style={{ objectFit: 'cover', width: '100%', height: 'auto', aspectRatio: '1/1' }}\n          />\n        </div>\n      )}\n      {top && (\n        <div className=\"ms-1\">\n          <div className=\"text-ellipsis fw-bold\">{data?.name}</div>\n          <div className=\"text-muted text-sm\">{data?.count} vues</div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst TopItemsCard = ({ hits = {}, itemKey = 'top_products', ...props }: any) => {\n  const { title = '' } = props;\n\n  const items = hits?.[itemKey] || [];\n  if (!Boolean(items.length)) return null;\n\n  const [item, ...rest] = items;\n\n  return (\n    <ViewSection border text={title} mainCN=\"d-grid gap-2\">\n      {item && <TopItemCard top data={item} />}\n      <HorizontalScrollGridLayout className=\"mt-2\" style={{ gridAutoColumns: 'min-content', gap: 6 }}>\n        {rest && rest.map((data) => <TopItemCard data={data} key={uuid()} />)}\n      </HorizontalScrollGridLayout>\n    </ViewSection>\n  );\n};\n\nconst PerformanceCard = ({ settingSlug, ...props }: any) => {\n  let [params, setParams] = useSearchParams();\n  const range = params.get('__range');\n  const { res, loading } = useRequest(() => API.get(`shopy-analytics/${settingSlug}/summary/`, { params }), {\n    refreshDeps: [range],\n  });\n\n  if (loading) return <Loading />;\n\n  const hitR = new Response(res);\n  if (!hitR.isSuccess) return null;\n\n  const { views_count = 0, visitors_count = 0, sent_message = 0, compare = {}, count } = hitR?.data;\n\n  return (\n    <Staff.Section\n      title=\"Performance\"\n      actions={\n        <div className=\"d-flex\">\n          <Button\n            onClick={() => setParams({ ...params, __range: 'today' })}\n            className={getCN(['btn me-1', range === 'today' && 'btn-primary'])}\n          >\n            Today\n          </Button>\n          <Button\n            onClick={() => setParams({ ...params, __range: 'week' })}\n            className={getCN(['btn me-1', range === 'week' && 'btn-primary'])}\n          >\n            Week\n          </Button>\n          <Button\n            onClick={() => setParams({ ...params, __range: 'month' })}\n            className={getCN(['btn me-1', range === 'month' && 'btn-primary'])}\n          >\n            Month\n          </Button>\n          <Button\n            onClick={() => {\n              params.delete('__range');\n              setParams({ ...params });\n            }}\n            className={getCN(['btn me-1', !range && 'btn-primary'])}\n          >\n            All\n          </Button>\n        </div>\n      }\n    >\n      <div className=\"d-grid gap-2 mb-3\">\n        <div className=\"\">\n          Messages: {sent_message}\n          {compare?.sent_message > 0 && <span className=\"text-sm text-muted\">/{compare.sent_message}</span>}\n        </div>\n\n        <div className=\"\">\n          Visitors: {visitors_count}\n          {compare?.visitors_count > 0 && <span className=\"text-sm text-muted\">/{compare.visitors_count}</span>}\n        </div>\n        <div className=\"\">\n          Page views: {views_count}\n          {compare?.views_count > 0 && <span className=\"text-sm text-muted\">/{compare.sent_message}</span>}\n        </div>\n      </div>\n\n      {/* bar chart with compare value */}\n\n      <div className=\"d-grid grid-md-2 gap-2\">\n        <TopItemsCard hits={hitR?.data} title=\"Top viewed products\" itemKey=\"top_products\" />\n        <TopItemsCard hits={hitR?.data} title=\"Top viewed categories\" itemKey=\"top_cats\" />\n      </div>\n    </Staff.Section>\n  );\n};\n\nexport default function ShopStaffIndexView() {\n  useDocumentTitle('Store');\n  const ctx = React.useContext(SharedDataCtx);\n  const { isLoaded, products, orders, cats, shopy_settings, site = {} } = ctx;\n  const settingSlug = site.settings;\n\n  if (!isLoaded) return null;\n\n  return (\n    <Staff.View\n      title=\"Commerce\"\n      className=\"no-bg\"\n      back=\"/staff/\"\n      actions={\n        <div className=\"d-flex\">\n          <Staff.NavLink to=\"notifications/\" className=\"btn btn-round btn-secondary-3\" title=\"Action needed\">\n            <Icons.Notification />\n          </Staff.NavLink>\n\n          <Staff.NavLink to=\"settings/\" className=\"btn btn-round btn-secondary-3\" title=\"Shop settings\">\n            <Icons.Adjustments />\n          </Staff.NavLink>\n        </div>\n      }\n    >\n      <Staff.Section>\n        <div className=\"d-grid grid-2 grid-sm-3 grid-md-4 grid-lg-6\">\n          {shopy_settings?.config?.has_suppliers && (\n            <CardLink\n              title=\"Supplier Orders\"\n              tab=\"./\"\n              link={{ to: 'orders/', text: 'View all orders', perms: ['store.view_supplierorder'] }}\n            >\n              <h3>{orders?.count || 0}</h3>\n            </CardLink>\n          )}\n\n          <CardLink\n            title=\"Products\"\n            tab=\"./?tab=products\"\n            link={{ to: 'products', text: 'View all products', perms: ['store.view_product'] }}\n          >\n            <h3>{products?.count || 0}</h3>\n          </CardLink>\n\n          <CardLink\n            tab=\"./?tab=categories\"\n            title=\"Categories\"\n            link={{ to: 'categories', text: 'View all categories', perms: ['store.view_category'] }}\n          >\n            <h3>{cats?.count || 0}</h3>\n          </CardLink>\n        </div>\n      </Staff.Section>\n\n      {settingSlug && <PerformanceCard {...{ settingSlug }} />}\n\n      <Staff.Section title=\"Products by category\" className=\"my-2\">\n        {cats?.cat_count\n          ?.filter((i) => i.category__name)\n          ?.map(({ category__name, count }, i) => (\n            <div key={i}>\n              {category__name}: {count}\n            </div>\n          ))}\n      </Staff.Section>\n    </Staff.View>\n  );\n}\n\nconst CardLink: React.FC<{\n  title: string;\n  tab?: string;\n  link: { to: string; text: string; perms: string[] };\n}> = ({ children, title, link, tab = './' }) => {\n  const { to } = link;\n  return (\n    <div className=\"card-link mb-3\">\n      <Staff.NavLink to={tab}>\n        {title && <div className=\"card-link-title\">{title}</div>}\n        {children}\n      </Staff.NavLink>\n\n      <Staff.Link to={to} requiredPerms={link.perms}>\n        {link?.text && `${link.text} »`}\n      </Staff.Link>\n    </div>\n  );\n};\n","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _toArray(arr) {\n  return arrayWithHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableRest();\n}"],"names":["TopItemCard","props","data","top","className","title","name","count","img","style","width","maxWidth","src","getImgUrl","alt","truncateStr","objectFit","height","aspectRatio","TopItemsCard","hits","itemKey","items","Boolean","length","arr","arrayWithHoles","iterableToArray","unsupportedIterableToArray","nonIterableRest","item","rest","border","text","mainCN","gridAutoColumns","gap","map","uuid","PerformanceCard","settingSlug","useSearchParams","params","setParams","range","get","useRequest","API","refreshDeps","res","loading","hitR","Response","isSuccess","views_count","visitors_count","sent_message","compare","actions","onClick","__range","getCN","delete","ShopStaffIndexView","useDocumentTitle","ctx","React","SharedDataCtx","isLoaded","products","orders","cats","shopy_settings","site","settings","back","to","config","has_suppliers","CardLink","tab","link","perms","cat_count","filter","i","category__name","children","requiredPerms"],"sourceRoot":""}