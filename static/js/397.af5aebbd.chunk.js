"use strict";(self.webpackChunk_storepy_clientjs=self.webpackChunk_storepy_clientjs||[]).push([[397],{324:function(e,n,r){r.d(n,{CB:function(){return m},V5:function(){return v}});var t=r(8519),i=r(8312),s=(r(2411),r(2145)),o=r(5603),a=r(2898),c=r(8136),l=["instance","fields","children"],u=["onSuccess","onError","onWillSubmit"],d=["label","error"],m=function(e){var n=(0,o.cI)({name:""});return(0,c.jsxs)(h,{context:n,onSubmit:function(r){return r.preventDefault(),(0,a.D)().create(n.values).then((function(n){var r;return null===e||void 0===e||null===(r=e.onSuccess)||void 0===r?void 0:r.call(e,n)})).catch((function(r){var t;n.handleError(r),null===e||void 0===e||null===(t=e.onError)||void 0===t||t.call(e,r)}))},children:[(0,c.jsx)("div",{className:"",children:(0,c.jsx)(h.NameField,{error:n.errors.name})}),(0,c.jsx)("div",{className:"my-3",children:(0,c.jsx)(o.ZP.Submit,{value:"Save category",className:"btn btn-primary"})})]})},v=function(e){var n,r,o,a=e.instance,d=void 0===a?(0,s.q9)("Category instance"):a,m=e.fields,v=void 0===m?[]:m,p=e.children,f=(0,i.Z)(e,l),x=f.onSuccess,j=f.onError,b=f.onWillSubmit,g=(0,i.Z)(f,u),Z=g.context;return(0,c.jsxs)(h,(0,t.Z)((0,t.Z)({},g),{},{onSubmit:function(e){e.preventDefault(),null===b||void 0===b||b();var n={};return v.forEach((function(e){var r=Z.values[e];null!=r&&(n[e]=r)})),d.update(n).then((function(e){return null===x||void 0===x?void 0:x(e)})).catch((function(e){var n;return j?j(e):null===Z||void 0===Z||null===(n=Z.handleError)||void 0===n?void 0:n.call(Z,e)}))},children:[v.includes("name")&&(0,c.jsx)(h.NameField,{label:"Nom de la cat\xe9gorie",error:null===Z||void 0===Z||null===(n=Z.errors)||void 0===n?void 0:n.name,text:"Ajoutez un nom qui d\xe9crit cette cat\xe9gorie.\nNous recommandons 65 caract\xe8res au max."}),v.includes("description")&&(0,c.jsx)(h.DescriptionField,{label:"Description",error:null===Z||void 0===Z||null===(r=Z.errors)||void 0===r?void 0:r.description,text:"D\xe9crivez cet cat\xe9gorie."}),v.includes("position")&&(0,c.jsx)(h.PositionField,{label:"Position",error:null===Z||void 0===Z||null===(o=Z.errors)||void 0===o?void 0:o.position}),p]}))},h=function(e){return(0,c.jsx)(o.ZP,(0,t.Z)({},e))};h.NameField=function(e){return(0,c.jsx)(o.wd,(0,t.Z)((0,t.Z)({placeholder:"Entrez le nom de la cat\xe9gorie ..."},e),{},{required:!0}))},h.DescriptionField=function(e){return(0,c.jsx)(o.F$,(0,t.Z)({},e))},h.PositionField=function(e){var n=e.label,r=e.error,s=(0,i.Z)(e,d);return(0,c.jsx)(o.ZP.Field,{label:n,error:r,children:(0,c.jsx)(o.ZP.Text,(0,t.Z)({name:"position",type:"number",min:0},s))})}},7397:function(e,n,r){r.r(n),r.d(n,{StaffCategory:function(){return h.D},default:function(){return b}});var t=r(8519),i=r(8312),s=r(6009),o=r(2411),a=r(6520),c=r(1408),l=r(1096),u=r(2145),d=r(2134),m=r(2379),v=r(6574),h=r(2898),p=r(324),f=r(5603),x=r(8136),j=["item"];function b(){var e=(0,a.s0)(),n=(0,c.lr)(),r=(0,s.Z)(n,1)[0].get("page"),t=(0,d.QT)((function(){return(0,h.D)().list({params:{page:r}})}),{refreshDeps:[r]}),i=t.res,m=t.updateItem,v=(t.refresh,o.useState(!1)),f=(0,s.Z)(v,2),j=f[0],b=f[1],Z=new u.HM(i);return Z.isSuccess?(0,x.jsxs)(l.ZP.View,{title:"Cat\xe9gories",back:"/staff/store/",actions:(0,x.jsx)(l.ZP.Button,{onClick:function(){return b(!j)},className:"btn-primary-3",title:"Add a new category",requiredPerms:["store.add_category"],children:"Ajouter"}),requiredPerms:["store.view_category"],children:[j&&(0,x.jsx)("div",{className:"miq-container center",children:(0,x.jsx)(l.ZP.Section,{title:"Add a category",requiredPerms:["store.add_category"],border:!0,children:(0,x.jsx)(p.CB,{onSuccess:function(n){var r=n.data;return e(r.slug)}})})}),0===Z.items.length&&!j&&(0,x.jsxs)("div",{className:"text-center p-staff-list-empty py-3 my-3",children:[(0,x.jsx)("p",{className:"fw-light text-md",children:"Ajouter une cat\xe9gorie pour commencer"}),(0,x.jsx)("div",{className:"my-4",children:(0,x.jsx)(l.ZP.Button,{onClick:function(){return b(!j)},requiredPerms:["store.add_category"],className:"btn btn-primary btn-md",children:"Add a category"})})]}),Z.items.sort((function(e,n){return e.position>n.position?1:-1})).map((function(e){return(0,x.jsx)(g,{item:e,onUpdate:function(e){m(e.data)}},e.slug)}))]}):null}var g=function(e){var n=e.item,r=(0,i.Z)(e,j),a=o.useState(!1),c=(0,s.Z)(a,2),u=c[0],d=c[1],b=(0,h.D)(n),g=(0,f.cI)({name:(null===b||void 0===b?void 0:b.name)||"",description:(null===b||void 0===b?void 0:b.description)||"",position:(null===b||void 0===b?void 0:b.position)||0});return(0,x.jsx)(m.vz,{border:!0,title:(0,x.jsxs)("div",{onClick:function(){return d(!u)},className:"d-flex align-items-center",children:[(0,x.jsx)("div",{style:{width:48,height:48},children:(0,x.jsx)(l.ZP.Img.Square,(0,t.Z)((0,t.Z)({slug:"slug",src:"src"},b.cover_data),{},{className:"rounded"}))}),(0,x.jsxs)("div",{className:"ms-1",children:[(0,x.jsxs)("div",{className:"text-ellipsis",children:[(0,x.jsx)("span",{className:"me-1",children:g.values.name}),(0,x.jsx)(v.TK,{show:b.is_published})]}),(0,x.jsxs)("div",{className:"text-sm",children:[(0,x.jsxs)("span",{children:["Total: ",b.products_count," "]}),(0,x.jsxs)("span",{children:["(",b.published_count,"/",(0,x.jsx)("span",{className:"text-muted",children:b.draft_count}),")"]})]})]})]}),actions:(0,x.jsx)("div",{children:(0,x.jsx)(l.ZP.Link,{to:"".concat(b.slug,"/"),className:"btn btn-square btn-primary-3",requiredPerms:["store.change_category"],children:(0,x.jsx)(m.PJ.ws,{})})}),className:"mb-1",children:u&&(0,x.jsx)("div",{className:"",children:(0,x.jsx)(p.V5,{context:g,instance:b,fields:["name","description","position"],onSuccess:r.onUpdate,children:(0,x.jsx)("div",{className:"d-flex justify-content-center",children:(0,x.jsx)(f.ZP.Submit,{value:"Sauvegarder",className:"btn-primary-3 min-w-25"})})})})})}},2898:function(e,n,r){r.d(n,{D:function(){return u}});var t=r(8519),i=r(1135),s=r(7411),o=r(2518),a=r(2485),c=r(1096),l=function(e){(0,o.Z)(r,e);var n=(0,a.Z)(r);function r(){return(0,i.Z)(this,r),n.apply(this,arguments)}return(0,s.Z)(r,[{key:"publish",value:function(){return this.update({is_published:!0})}},{key:"unpublish",value:function(){return this.update({is_published:!1})}}]),r}(c.x5),u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.dt_published;return n&&(n=new Date(n)),(0,c.eR)((0,t.Z)((0,t.Z)({},e),{},{dt_published:n}),"categories",l)}}}]);
//# sourceMappingURL=397.af5aebbd.chunk.js.map