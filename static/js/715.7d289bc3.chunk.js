"use strict";(self.webpackChunk_storepy_clientjs=self.webpackChunk_storepy_clientjs||[]).push([[715],{1609:function(e,r,t){t.r(r),t.d(r,{ProductDeleteButton:function(){return a.sq},ProductFields:function(){return o},ProductListFilterForm:function(){return d.i},StaffProduct:function(){return i.Z},default:function(){return v},useProductListRequest:function(){return c._}});var n=t(7406),s=t(9996),l=t(7457),i=t(6567),c=t(5202),a=t(1161),o=t(5617),d=t(2048),u=n.lazy((function(){return t.e(11).then(t.bind(t,6011))})),x=n.lazy((function(){return t.e(360).then(t.bind(t,8360))})),m=n.lazy((function(){return t.e(115).then(t.bind(t,5115))}));function v(){return(0,l.jsxs)(s.Z5,{children:[(0,l.jsx)(s.AW,{path:":prodSlug/",element:(0,l.jsx)(u,{})}),(0,l.jsx)(s.AW,{path:"new",element:(0,l.jsx)(x,{})}),(0,l.jsx)(s.AW,{index:!0,element:(0,l.jsx)(m,{})})]})}},9123:function(e,r,t){t.d(r,{C4:function(){return Z},Jm:function(){return b},t0:function(){return g}});var n=t(3251),s=t(3872),l=t(4384),i=t(7406),c=t(9576),a=t(1475),o=t(7457),d=["instance","fields"],u=["onSuccess","onError"],x=["label","text","error"],m=["label","text","error"],v=["label","text","error"],h=["label","text","error"],p=["label","text","error","currencies"],f=["label","text","error","suppliers"],j=["children"],g=function(e){var r=e.instance,t=e.fields,n=(0,l.Z)(e,d),i=n.onSuccess,c=n.onError,a=(0,l.Z)(n,u),x=a.context;return(0,o.jsx)(b,(0,s.Z)((0,s.Z)({},a),{},{onSubmit:function(e){e.preventDefault();var n={};return t.forEach((function(e){var r=x.values[e];null!=r&&(n[e]=r)})),r.update(n).then((function(e){return null===i||void 0===i?void 0:i(e)})).catch((function(e){var r;return c?c(e):null===x||void 0===x||null===(r=x.handleError)||void 0===r?void 0:r.call(x,e)}))}}))},b=function(e){return(0,o.jsx)(c.ZP,(0,s.Z)({},e))};b.NameField=function(e){var r=e.label,t=void 0===r?"Name":r,n=e.text,i=void 0===n?"Write a name to help remember your order.":n,a=e.error,d=(0,l.Z)(e,x);return(0,o.jsx)(c.ZP.Field,{label:t,text:i,error:a,children:(0,o.jsx)(c.ZP.Text,(0,s.Z)((0,s.Z)({placeholder:"Nom",maxLength:99},d),{},{name:"name"}))})},b.OrderIDField=function(e){var r=e.label,t=void 0===r?"Order ID":r,n=e.text,i=e.error,a=(0,l.Z)(e,m);return(0,o.jsx)(c.ZP.Field,{label:t,text:n,error:i,children:(0,o.jsx)(c.ZP.Text,(0,s.Z)((0,s.Z)({placeholder:"Order ID",maxLength:99},a),{},{name:"order_id"}))})},b.IsPaidField=function(e){var r=e.label,t=void 0===r?"Pay\xe9":r,n=e.text,i=e.error,a=(0,l.Z)(e,v);return(0,o.jsx)(c.ZP.Field,{label:t,text:n,error:i,checkbox:!0,children:(0,o.jsx)(c.ZP.Checkbox,(0,s.Z)((0,s.Z)({},a),{},{name:"is_paid"}))})},b.TotalCostField=function(e){var r=e.label,t=void 0===r?"Co\xfbt total":r,n=e.text,i=e.error,a=(0,l.Z)(e,h);return(0,o.jsx)(c.ZP.Field,{label:t,text:n,error:i,children:(0,o.jsx)(c.ZP.Text,(0,s.Z)((0,s.Z)({min:"0",step:"0.01"},a),{},{required:!0,type:"number",name:"total_cost"}))})},b.CurrencyField=function(e){var r=e.label,t=e.text,n=void 0===t?"Select the supplier currency.":t,a=e.error,d=e.currencies,u=(0,l.Z)(e,p);return(0,o.jsx)(c.ZP.Field,{label:r,text:n,error:a,children:(0,o.jsx)(c.ZP.Select,(0,s.Z)((0,s.Z)({},u),{},{required:!0,name:"currency",nullValue:{label:"S\xe9lectionnez une monnaie ..."},children:null===d||void 0===d?void 0:d.map((function(e){return(0,i.createElement)(c.ZP.Option,(0,s.Z)((0,s.Z)({},e),{},{key:e.value}))}))}))})},b.SupplierField=function(e){var r=e.label,t=e.text,n=void 0===t?"Select the supplier.":t,a=e.error,d=e.suppliers,u=(0,l.Z)(e,f);return(0,o.jsx)(c.ZP.Field,{label:r,text:n,error:a,children:(0,o.jsx)(c.ZP.Select,(0,s.Z)((0,s.Z)({},u),{},{required:!0,name:"supplier",nullValue:{label:"S\xe9lectionnez le supplier ..."},children:null===d||void 0===d?void 0:d.map((function(e){return(0,i.createElement)(c.ZP.Option,(0,s.Z)((0,s.Z)({},e),{},{key:e.value}))}))}))})},b.StageSelectField=function(e){return(0,o.jsx)(a.HG.StageSelectField,(0,s.Z)({required:!1},e))};var Z=function(e){e.children;var r,t=(0,l.Z)(e,j),a=t.orderInstance,d=t.onSuccess,u=t.onError,x=null===a||void 0===a||null===(r=a.supplier)||void 0===r?void 0:r.toLowerCase(),m=(0,c.cI)({supplier_name:x,url:""}),v=i.useState(!1),h=(0,n.Z)(v,2),p=h[0],f=h[1];return(0,o.jsxs)(c.ZP,{context:m,onSubmit:function(e){e.preventDefault();var r=m.values.url,t=function(e){return f(!1),m.setValue("url",""),null===d||void 0===d?void 0:d(e)},n=function(e){return m.setErrors((0,s.Z)((0,s.Z)({},m.errors),{},{url:"Something went wrong."})),f(!1),null===u||void 0===u?void 0:u(e)},l="Invalid Url: does not match supplier ".concat(a.supplier);switch(x){case"fnova":return r.includes("fashionnova")?(f(!0),a.postFnova(r).then(t).catch(n)):m.setErrors({url:l});case"plt":return r.includes("prettylittlething")?(f(!0),a.postPlt(r).then(t).catch(n)):m.setErrors({url:l});default:return r.includes(x)?(f(!0),a.postShein(r).then(t).catch(n)):m.setErrors({url:l})}},className:"supplier-product-add-form",children:[(0,o.jsx)(c.ZP.Field,{error:m.errors.url,children:(0,o.jsxs)("div",{className:"d-flex flex-column flex-md-row align-items-center",children:[(0,o.jsx)(c.ZP.Text,{required:!0,autoFocus:!0,name:"url",type:"url",placeholder:"Add ".concat(x," product source url ..."),className:"me-1",disabled:p}),(0,o.jsx)("div",{className:"mt-1 mt-md-0",children:(0,o.jsx)(c.ZP.Submit,{value:"Add product",className:"btn btn-primary-3",disabled:p})})]})}),p&&(0,o.jsx)("div",{className:"my-3",children:"Getting product data. Please wait ..."})]})}},5715:function(e,r,t){t.r(r),t.d(r,{default:function(){return k},mapDataToValues:function(){return _}});var n=t(3872),s=t(3251),l=t(4384),i=t(7406),c=t(9996),a=t(5789),o=t(9576),d=t(9474),u=t(9450),x=t(2050),m=t(1609),v=t(683),h=t(5492),p=t(1910),f=t(1475),j=t(7457);function g(e){var r,t=e.orderInstance,l=e.refreshOrder,u=e.categories,v=e.stages;(0,d.jr)("Supplier products");var h=(0,c.UO)().ordSlug,p=(0,m.useProductListRequest)({},{supplier_order_slug:h}),g=p.res,b=void 0===g?{data:{results:[]}}:g,N=p.loading,y=p.refresh,S=i.useState([]),P=(0,s.Z)(S,2),_=P[0],k=P[1],F=(0,o.cI)({category:"",is_pre_sale:""});if(N)return(0,j.jsx)(x.gb,{});var C=0!==_.length;return(0,j.jsx)(a.ZP.Section,{actions:C&&(0,j.jsx)(j.Fragment,{children:(0,j.jsx)("span",{className:"p-1",onClick:function(){return k([])},style:{cursor:"pointer"},children:"[x]"})}),footer:(0,j.jsx)(x.tl,(0,n.Z)((0,n.Z)({},b.data),{},{component:a.ZP.NavLink,to:!0})),className:"supplier-p-list",children:null!==(r=b.data)&&void 0!==r&&r.results.length?(0,j.jsxs)(j.Fragment,{children:[C&&(0,j.jsxs)("div",{className:"d-grid grid-2 grid-md-4 gap-2",style:{position:"sticky",top:0,zIndex:1e3},children:[(0,j.jsx)("div",{className:"",children:(0,j.jsxs)(o.ZP,{context:F,onSubmit:function(e){e.preventDefault();var r=F.values.category;r&&t.updateCategories(r,_).then((function(e){y(),F.setValue("category",""),k([])})).catch((function(e){return F.handleError(e)}))},children:[(0,j.jsx)("div",{className:"d-flex",children:u&&(0,j.jsx)(f.HG.CategoryField,{categories:u,error:F.errors.category})}),(0,j.jsx)(o.ZP.Submit,{className:"btn-primary",children:"Update"})]})}),(0,j.jsxs)("div",{children:[(0,j.jsx)(x.zx,{className:"me-1",onClick:function(){t.markPresale(_).then((function(){y()})).catch((function(e){return F.handleError(e)}))},children:"Mark presale"}),(0,j.jsx)(x.zx,{onClick:function(){t.unmarkPresale(_).then((function(){y()})).catch((function(e){return F.handleError(e)}))},children:"unmark presale"})]})]}),b.data.results.map((function(e){return(0,i.createElement)(Z,{orderInstance:t,categories:u,selected:_,setSelected:k,refreshOrder:l,stages:v,instance:(0,m.StaffProduct)(e),key:e.slug})}))]}):null})}var b=function(e){var r=e.instance,t=e.selected,n=e.setSelected;return(0,j.jsx)("input",{type:"checkbox",name:"selected",className:"me-2",checked:t.includes(r.slug),onChange:function(e){var s=e.target.checked;n(s?[].concat((0,h.Z)(t),[r.slug]):function(e){return e.filter((function(e){return e!==r.slug}))})}})},Z=function(e){var r,t=i.useState(!1),l=(0,s.Z)(t,2),c=l[0],o=l[1],d=e.instance,u=e.categories,v=i.useState(!1),h=(0,s.Z)(v,2),g=h[0],Z=h[1];if(c)return null;var N=d.supplier_item,y=d.stage,S=e.orderInstance,P=e.stages,_=void 0===P?[]:P,k=null===_||void 0===_?void 0:_.find((function(e){return e.value===y}));return(0,j.jsx)(x.vz,{border:!0,title:(0,j.jsxs)("div",{className:"d-flex align-items-center",children:[(0,j.jsx)(b,(0,n.Z)({},e)),(0,j.jsx)("div",{style:{minWidth:48,width:48,height:"auto"},onClick:function(){return Z(!g)},children:(0,j.jsx)(a.ZP.Img.Thumb,(0,n.Z)((0,n.Z)({slug:"slug",src:"src"},d.cover_data),{},{className:"rounded"}))}),(0,j.jsxs)("div",{className:"d-grid mx-1 text-sm",children:[(0,j.jsx)(p.dq,{product:d,className:""}),(0,j.jsxs)("div",{className:"",children:[(0,j.jsxs)("div",{children:[d.is_on_sale&&d.sale_price&&(0,j.jsxs)("span",{className:"",children:[d.sale_price," ","<-"," "]}),(0,j.jsx)("span",{className:"",children:d.retail_price}),(0,j.jsxs)("span",{className:"text-muted",children:[" | ",null===N||void 0===N?void 0:N.cost," ",S.currency]})]}),(0,j.jsxs)("div",{className:"",children:[(null===(r=d.category_data)||void 0===r?void 0:r.name)||" - ",(0,j.jsxs)("span",{className:"text-muted",children:[" | ",(null===N||void 0===N?void 0:N.category)||"-"]})]}),k&&(0,j.jsx)("span",{className:"text-muted",children:k.label}),(0,j.jsx)("a",{className:"ms-1",href:"",target:"_blank",rel:"noopener noreferrer",children:"\u2197\ufe0f"})]})]})]}),actions:(0,j.jsxs)("div",{className:"d-flex flex-column-reverse flex-md-row",children:[(0,j.jsx)("div",{className:"",children:(0,j.jsx)(m.ProductDeleteButton,{instance:d,onSuccess:function(){var r;o(!0),null===e||void 0===e||null===(r=e.refreshOrder)||void 0===r||r.call(e)},className:"btn-square"})}),(0,j.jsx)("div",{className:"ms-md-1 mb-1",children:(0,j.jsx)(a.ZP.Link,{to:"./".concat(d.slug,"/"),className:"btn btn-primary-3 btn-square",children:(0,j.jsx)(x.PJ.I8,{})})})]}),className:"suppier-p-list-item bg-white",children:g&&(0,j.jsxs)(x.j6,{className:"form-tab no-scroll-bar gap-2",children:[(0,j.jsx)(f.iB,{instance:d,categories:u,orderSlug:null===S||void 0===S?void 0:S.slug}),(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("div",{className:"mb-1",children:"".concat(null!==N&&void 0!==N&&N.item_id?(0,j.jsxs)("span",{className:"",children:["Item ID: ",null===N||void 0===N?void 0:N.item_id]}):"")}),(0,j.jsxs)("ul",{children:[(null===N||void 0===N?void 0:N.category)&&(0,j.jsxs)("li",{className:"mb-1",children:[(0,j.jsx)("div",{className:"text-sm",children:"Supplier Category"}),(0,j.jsx)("div",{className:"text-muted",children:null===N||void 0===N?void 0:N.category})]}),(0,j.jsxs)("li",{className:"mb-1",children:[(0,j.jsxs)("div",{className:"text-sm",children:["FOB Cost(",S.currency,")"]}),(0,j.jsx)("div",{className:"text-muted",children:null===N||void 0===N?void 0:N.cost})]}),(null===N||void 0===N?void 0:N.url)&&(0,j.jsx)("li",{className:"",children:(0,j.jsx)("a",{href:null===N||void 0===N?void 0:N.url,target:"_blank",className:"text-underline",rel:"noopener noreferrer",children:"View supplier product page"})})]})]})]})})},N=t(9123),y=["category__name"],S=["children","tab","active"],P={name:"",order_id:"",stage:"",currency:"USD",supplier:"",is_paid:!1,total_cost:""},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={};return Object.keys(P).forEach((function(t){r[t]=e["".concat(t)]||P["".concat(t)]})),r};function k(){var e,r,t,n=(0,c.UO)().ordSlug,s=(0,o.cI)(_()),l=i.useContext(u.h2),m=l.suppliers,h=l.currencies,p=s.setValues,f=(0,d.QT)((function(){return(0,v.e)({slug:n}).retrieve()}),{refreshDeps:[n],onSuccess:function(e){var r;document.title="".concat(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.name," - Update supplier order"),p(_(e.data))}}),b=f.res,Z=f.loading,y=f.setLoading,S=f.setRes,P=f.refresh,k=new d.HM(b);if(!k.isSuccess)return null;var w=(0,v.e)(k.data);return w.supplier&&w.currency?(0,j.jsx)(a.ZP.View,{title:s.values.name,back:"/staff/store/orders/",actions:(0,j.jsx)(a.ZP.NavLink,{to:"settings/",children:(0,j.jsx)(x.PJ.XV,{})}),children:(0,j.jsxs)("div",{className:"d-flex flex-column flex-xl-row",children:[(0,j.jsx)("div",{className:"w-100",children:(0,j.jsx)(a.ZP.Section,{header:(0,j.jsx)(C,{instance:w,setLoading:y,setOrder:S,categories:null===k||void 0===k||null===(e=k.data)||void 0===e?void 0:e.categories}),children:Z?(0,j.jsx)(x.gb,{icon:!0}):(0,j.jsx)(g,{orderInstance:w,categories:null===k||void 0===k||null===(r=k.data)||void 0===r?void 0:r.categories,stages:null===k||void 0===k||null===(t=k.data)||void 0===t?void 0:t.stages,refreshOrder:P})})}),(0,j.jsx)("div",{className:"min-w-35 ps-md-1",children:(0,j.jsx)(F,{loading:Z,instance:w})})]})}):(0,j.jsx)(a.ZP.View,{title:"Modifier une commande",back:"/staff/store/orders/",children:(0,j.jsx)(a.ZP.Section,{className:"d-flex justify-content-center mt-4",children:(0,j.jsxs)(N.t0,{context:s,instance:w,fields:["name","currency","supplier"],onSuccess:function(e){return S(e)},children:[(0,j.jsx)(N.Jm.NameField,{required:!0,label:"Nom",error:s.errors.currency}),(0,j.jsx)(N.Jm.SupplierField,{required:!0,label:"Supplier",suppliers:m,error:s.errors.supplier}),(0,j.jsx)(N.Jm.CurrencyField,{required:!0,label:"Supplier Currency",currencies:h,error:s.errors.currency}),(0,j.jsx)(o.ZP.Submit,{value:"Sauvegarder",className:"btn-primary-3"})]})})})}var F=function e(r){var t,n,s,i,c,o=r.loading,d=r.instance;return(0,j.jsxs)(a.ZP.Section,{border:!0,className:"bg-white mb-1",title:"Order Details".concat(!o&&" (".concat(null===(t=d.products)||void 0===t?void 0:t.length,")")),text:"Supplier: ".concat(d.supplier," | Currency: ").concat(d.currency),children:[(0,j.jsxs)("div",{className:"mb-2",children:["Categories",(0,j.jsx)("ul",{children:null===d||void 0===d||null===(n=d.by_categories)||void 0===n||null===(s=n.filter((function(e){return null===e||void 0===e?void 0:e.category__name})))||void 0===s?void 0:s.map((function(r){var t=r.category__name,n=(0,l.Z)(r,y);return(0,j.jsxs)(e.Li,{title:t,children:[": ",n.count]},t)}))})]}),(0,j.jsxs)("ul",{className:"mb-3",children:[(0,j.jsxs)(e.Li,{title:"Average cost: ",children:[d.avg_cost," ",d.currency]}),(0,j.jsx)(e.Li,{title:"Total cost: ",children:"".concat(d.total_cost||(null===d||void 0===d||null===(i=d.items_cost)||void 0===i?void 0:i.amountWithSymbol)," ").concat(d.currency)}),(0,j.jsx)(e.Li,{title:"Est. revenue: ",children:null===d||void 0===d||null===(c=d.items_revenue)||void 0===c?void 0:c.amount})]})]})};F.Li=function(e){var r=e.children,t=e.title;return(0,j.jsxs)("li",{children:[(0,j.jsx)("span",{className:"mr-2 text-muted",children:t}),r]})};var C=function(e){var r=e.instance,t=e.setLoading,n=e.setOrder,l=e.categories,c=i.useState("filter"),o=(0,s.Z)(c,2),d=o[0],u=o[1];return(0,j.jsx)(a.ZP.Section,{border:!0,title:(0,j.jsx)("div",{children:(0,j.jsx)(w,{tab:d,onClick:function(){return u("filter")},active:"filter"===d,children:(0,j.jsx)(x.PJ.oe,{})})}),actions:(0,j.jsx)(w,{tab:d,onClick:function(){return u("add")},active:"add"===d,children:(0,j.jsx)(x.PJ.v3,{})}),className:"bg-white mb-1",children:(0,j.jsx)("div",{className:"",style:{top:0,position:"sticky"},children:"add"===d?(0,j.jsx)(N.C4,{orderInstance:r,onSuccess:function(e){t(),n(e)}}):(0,j.jsx)(m.ProductListFilterForm,{categories:l,fields:["category","published","presale"]})})})},w=function(e){var r=e.children,t=(e.tab,e.active),s=(0,l.Z)(e,S);return(0,j.jsx)(a.ZP.Button,(0,n.Z)((0,n.Z)({className:"btn-primary-3",style:{border:t?"1px solid var(--blue-600)":void 0}},s),{},{children:r}))}}}]);
//# sourceMappingURL=715.7d289bc3.chunk.js.map