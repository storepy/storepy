{"version":3,"file":"static/js/846.293467c4.chunk.js","mappings":"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","sources":["../../../../shopy/shopy-salejs/src/cart/utils.ts","../../../../shopy/shopy-salejs/src/cart/views.Update.tsx","../../../../shopy/shopy-salejs/src/discount/index.tsx"],"sourcesContent":["import { getStaffModel, StaffService } from '@miq/staffjs';\nimport { TPriceData, TProductSize } from '@shopy/storejs';\n\nimport type { TDiscount } from '../types';\nimport type { TCustomer } from '../customer';\n\nconst timeout = 5000;\n\nexport type TAPIOrderItem = {\n  slug: string;\n  product: {\n    // slug: string;\n    meta_slug: string;\n    name: string;\n    name_truncated: string;\n    cover: string;\n    cover_data: {\n      src: string;\n      src_mobile: string;\n      thumb: string;\n      thumb_sq: string;\n      alt_text: string;\n      caption: string;\n    };\n    price: TPriceData;\n    retail_price: string;\n    retail_price_data: TPriceData;\n    sale_price: string;\n    sale_price_data: TPriceData;\n    is_on_sale: boolean;\n    is_oos: boolean;\n  };\n  size: string;\n  size_data: TProductSize;\n  quantity: number;\n};\n\nexport type TAPICart = {\n  slug?: string;\n  customer?: string;\n  customer_name?: string;\n  products?: string[];\n  items?: TAPIOrderItem[];\n};\n\nexport type TOrderItem = Record<string, any> & {\n  order?: string;\n  product?: string;\n  product_data?: any;\n  name?: string;\n  price?: string;\n  size?: string;\n  was_sale?: boolean;\n  img?: string;\n  quantity?: number;\n};\n\nexport type TCart = {\n  slug?: string;\n  customer?: string;\n  customer_name?: string;\n  customer_data?: TCustomer;\n  notes?: string;\n  is_paid?: boolean;\n  discounts?: TDiscount[];\n\n  dt_delivery?: string;\n  items?: TOrderItem[];\n  products?: string[];\n\n  is_placed?: boolean;\n  subtotal?: TPriceData;\n  total?: TPriceData;\n\n  created?: string;\n  updated?: string;\n};\n\nclass CartService extends StaffService<TCart> {\n  get createdDt() {\n    return this.data?.created\n      ? new Date(this.data.created!).toLocaleDateString(undefined, {\n          day: '2-digit',\n          weekday: 'short',\n          month: 'short',\n          year: '2-digit',\n        })\n      : null;\n  }\n\n  get canDestroy(): boolean {\n    return this?.data?.products?.length === 0;\n  }\n\n  mark_paid() {\n    return this.post(`${this._path}pay/`, {}, { timeout });\n  }\n\n  place() {\n    return this.post(`${this._path}place/`, {}, { timeout });\n  }\n\n  postDiscount(values: Exclude<TDiscount, 'slug' | 'amt_data'>) {\n    return this.post(`${this._path}discount/`, values);\n  }\n  destroyDiscount(discountSlug: string) {\n    return this.delete(`${this._path}discount/${discountSlug}/`);\n  }\n\n  addItems(values: { size: string; quantity: number; product_slug: string }[]) {\n    return this.post(`${this._path}products/`, values);\n  }\n\n  addItem(prodSlug: string, values: { size: string; quantity: number }) {\n    return this.post(`${this._path}product/${prodSlug}/`, values);\n  }\n\n  updateItem(prodSlug: string, values: Record<string, any>) {\n    return this.post(`${this._path}item/${prodSlug}/`, { ...values }, { timeout });\n  }\n\n  destroyItem(itemSlug: string) {\n    return this.delete(`${this._path}item/${itemSlug}/`, { timeout });\n  }\n}\n\nexport const Cart = getStaffModel<TCart, CartService>('carts', CartService);\n\nexport type TCartInstance = ReturnType<typeof Cart>;\n","import * as React from 'react';\nimport { Link, useNavigate, useParams } from 'react-router-dom';\n\nimport Staff from '@miq/staffjs';\nimport Form, { useForm } from '@miq/formjs';\nimport { useDocumentTitle } from '@miq/hookjs';\nimport { truncateStr, uuid } from '@miq/utiljs';\nimport { Button, Icons, Loading } from '@miq/componentjs';\nimport { SizeQuantityField, SizeSelectField, TProduct, ProductPriceDisplay } from '@shopy/storejs';\n\nimport { TCart, Cart } from './utils';\nimport { CustomerCard } from '../customer';\nimport { CartPriceListItem, ItemProductCard } from './components';\nimport { SharedDataCtx } from '@miq/contextjs';\nimport { CartItemDeleteButton } from './buttons';\n\nimport { TDiscount } from '../discount/types';\nimport { CartDiscountAddButton, CartDiscountDeleteListItem } from '../discount';\n\nconst CartPayView = React.lazy(() => import('./views.UpdatePay'));\n\nexport default function CartUpdateView() {\n  useDocumentTitle('Place cart - Sales');\n  const { cartSlug } = useParams();\n\n  const ctx = React.useContext(SharedDataCtx);\n  const { cart_data } = ctx;\n\n  const navigate = useNavigate();\n\n  if (cartSlug !== cart_data?.slug || !ctx.isLoaded) return <Loading />;\n\n  const cart = Cart(cart_data || {});\n\n  if (cart?.is_placed)\n    return (\n      <CartPayView\n        cart={cart}\n        onUpdate={(r) => {\n          ctx.updateKey('cart_data', { ...cart_data, ...r.data });\n        }}\n        onSuccess={() => {\n          navigate('../');\n        }}\n      />\n    );\n\n  return (\n    <Staff.View\n      title=\"Panier\"\n      text=\"Verifiez les informations du client et du panier avant de confirmer. Un panier sans produits ne peut pas être confirmé.\"\n      actions={\n        <div className=\"d-flex align-items-center\">\n          <div className=\"me-1\">\n            <CartDiscountAddButton\n              instance={cart}\n              onSuccess={(r) => {\n                ctx.updateKey('cart_data', { ...cart_data, ...r.data });\n              }}\n            />\n          </div>\n\n          <Link\n            to={`/staff/sales/carts/${cart?.slug}/items/`}\n            className=\"btn-primary-2 btn-round\"\n            title=\"Ajouter des produits\"\n          >\n            <Icons.CartPlus />\n          </Link>\n        </div>\n      }\n      back=\"/staff/sales/carts\"\n      headerCN=\"miq-container center\"\n    >\n      {/* <pre>{JSON.stringify(cart.export(), null, 2)}</pre> */}\n\n      <div className=\"miq-container center\">\n        <Staff.Section border title=\"Client\">\n          <CustomerCard data={cart.customer_data!} />\n        </Staff.Section>\n\n        <Staff.Section\n          border\n          title={`Panier (${cart?.products?.length} produits)`}\n          footer={\n            <div className=\"\">\n              <div className=\"d-flex justify-content-between\">\n                <CartPriceListItem label={'Sous-total'} amount={cart?.subtotal!} />\n              </div>\n\n              {cart.discounts &&\n                cart.discounts.length > 0 &&\n                cart?.discounts?.map((d: TDiscount) => {\n                  return (\n                    <CartDiscountDeleteListItem\n                      cart={cart}\n                      item={d}\n                      onSuccess={(r) => ctx.updateKey('cart_data', { ...cart_data, ...r.data })}\n                      className=\"d-flex justify-content-between\"\n                      key={d.slug}\n                    />\n                  );\n                })}\n\n              <div className=\"d-flex justify-content-between\">\n                <CartPriceListItem bold label={'Total'} amount={cart?.total!} />\n              </div>\n            </div>\n          }\n        >\n          {cart && cart?.items?.length > 0 ? (\n            <>\n              {cart.items?.map((i) => {\n                // console.log(i);\n\n                return (\n                  <div key={uuid()} className=\"d-flex justify-content-between align-items-center\">\n                    <ItemProductCard {...i} size={i.size_data} />\n                    <div>\n                      <CartItemDeleteButton\n                        cartInstance={cart}\n                        itemSlug={i?.slug}\n                        onSuccess={(r) => {\n                          ctx.updateData({ cart_data: r.data });\n                          // setRes(r);\n                        }}\n                      />\n                    </div>\n                  </div>\n                );\n              })}\n            </>\n          ) : (\n            <>Ajouter</>\n          )}\n        </Staff.Section>\n\n        <div className=\"text-center\">\n          <Button\n            onClick={() => {\n              cart\n                .place()\n                .then((r) => {\n                  ctx.updateData({ cart_data: r.data });\n                })\n                .catch((err) => console.log(err));\n            }}\n            disabled={cart?.products?.length <= 0}\n            className=\"btn-primary btn-md fw-bold w-50\"\n            title=\"Confirmer le panier\"\n          >\n            Confirmer\n          </Button>\n        </div>\n      </div>\n    </Staff.View>\n  );\n}\n\nexport const ProductAddForm = ({\n  item,\n  onItemClick,\n  ...props\n}: {\n  item: TProduct;\n  onItemClick: (p: TProduct, size: string, qty: string) => Promise<TCart>;\n}) => {\n  const form = useForm({ quantity: 1, size: '' });\n\n  if (!item?.slug) return null;\n\n  const { sizes = [], cover_data, name } = item;\n\n  return (\n    <Form\n      context={form}\n      onSubmit={(e) => {\n        e.preventDefault();\n        onItemClick(item, form.values.size, form.values.quantity).catch((err) => {\n          form.handleError(err);\n        });\n      }}\n    >\n      <Staff.Section\n        border\n        header={\n          <div className=\"d-flex\">\n            <div style={{ minWidth: 34, maxWidth: 50 }} className=\"me-1\">\n              <Staff.Img.Thumb src=\"src\" {...cover_data} className=\"rounded\" />\n            </div>\n\n            <div className=\"flex-1\" title={name}>\n              <div className=\"text-ellipsis text-sm\">\n                <span className=\"me-1 fw-bold\">{truncateStr(name!, 0, 45)}</span>\n              </div>\n\n              <div className=\"d-flex flex-column flex-md-ro justify-content-between\">\n                <div className=\"d-grid grid-md-2 gap-1 flex-1\">\n                  <SizeSelectField required sizes={sizes.filter((i) => i.quantity > 0)} error={form.errors.size} />\n                  <SizeQuantityField max={sizes.find((i) => i.slug === form.values.size)?.quantity || 0} min={1} />\n                </div>\n                <div className=\"text-right\">\n                  <Form.Submit className=\"btn btn-primary-2 btn-md fw-bold\">Ajouter</Form.Submit>\n                </div>\n              </div>\n            </div>\n          </div>\n        }\n        actions={<ProductPriceDisplay {...item} className=\"d-flex flex-wrap\" />}\n        className=\"mb-1\"\n      ></Staff.Section>\n    </Form>\n  );\n};\n","import * as React from 'react';\nimport { AxiosResponse } from 'axios';\n\nimport './discount.scss';\n\nimport type { TDiscount } from '../discount/types';\nimport type { TCartInstance } from '../cart/utils';\n\nimport Staff from '@miq/staffjs';\nimport { ProductPriceDisplay } from '@shopy/storejs';\nimport Form, { TFormUpdateProps, useForm } from '@miq/formjs';\nimport { Button, ConfirmButton, DoubleClickToEdit, Icons } from '@miq/componentjs';\n\nexport const CartDiscountAddButton = (props: Omit<TFormUpdateProps<{ instance: TCartInstance }>, 'context'>) => {\n  const form = useForm<TDiscount>({ description: '', amt: '' });\n  const { instance, onSuccess, onError } = props;\n  const canAddDiscount = instance.products!.length <= 0;\n\n  const close = (setOpen: (val: boolean) => void) => {\n    form.setValues({ description: '', amt: '' });\n    setOpen(false);\n  };\n\n  return (\n    <Form context={form} onSubmit={(e) => e.preventDefault()} className=\"cart-discount-form\">\n      <ConfirmButton\n        disabled={canAddDiscount}\n        modal={{ width: 'md', bodyCN: 'cart-discount-modal-body' }}\n        title={canAddDiscount ? 'Ajouter un produit avant de pouvoir ajouter une réduction' : 'Ajouter une réduction'}\n        renderHeader={() => (\n          <div className=\"fw-bold p-1 d-flex align-items-center\">\n            <Icons.PigMoney className=\"btn-round\" />\n            <div>Ajouter une réduction</div>\n          </div>\n        )}\n        renderFooter={({ setOpen }) => (\n          <div className=\"d-flex justify-content-between align-items-center p-2\">\n            <Button onClick={() => close(setOpen)}>Annuler</Button>\n\n            <Form.Submit\n              onClick={(e) => {\n                e.preventDefault();\n                instance\n                  .postDiscount(form.values)\n                  .then((r) => {\n                    close(setOpen);\n                    onSuccess?.(r);\n                  })\n                  .catch((err) => {\n                    form.handleError(err);\n                    onError?.(err);\n                  });\n              }}\n              className=\"btn-primary fw-bold w-50\"\n            >\n              Ajouter\n            </Form.Submit>\n          </div>\n        )}\n        render={() => (\n          <>\n            <div className=\"p-2\">\n              <Form.Field label=\"Description\" text=\"\" error={form.errors.description}>\n                <Form.Text\n                  placeholder=\"Décrivez la réduction ...\"\n                  required\n                  name=\"description\"\n                  minLength={4}\n                  maxLength={80}\n                />\n              </Form.Field>\n\n              <Form.Field label=\"Montant\" text=\"\" error={form.errors.amt}>\n                <Form.Text\n                  aria-describedby=\"sale_price_label\"\n                  min=\"0\"\n                  step=\"0.01\"\n                  required\n                  placeholder=\"Entrez le montant de la réduction ...\"\n                  type=\"number\"\n                  name=\"amt\"\n                />\n              </Form.Field>\n            </div>\n          </>\n        )}\n        className=\"btn-primary-3 btn-round fw-bold\"\n      >\n        <Icons.PigMoney />\n      </ConfirmButton>\n    </Form>\n  );\n};\n\nexport const CartDiscountDeleteListItem = ({\n  item,\n  cart,\n  ...props\n}: {\n  className?: string;\n  cart: TCartInstance;\n  item: TDiscount;\n  onSuccess?: (r: AxiosResponse) => void;\n  onError?: (err: AxiosResponse) => void;\n}) => {\n  return (\n    <DoubleClickToEdit\n      editView={({ setEdit }) => (\n        <div className=\"d-flex align-items-center justify-content-between\">\n          <div className=\"color-red-400 me-1\">\n            Supprimer <span className=\"fw-bold\">{item.description.slice(0, 30)}</span>?\n          </div>\n\n          <div className=\"d-flex\">\n            <Staff.Button\n              onClick={() => {\n                cart\n                  .destroyDiscount(item.slug!)\n                  .then((r) => {\n                    setEdit(false);\n                    props?.onSuccess?.(r);\n                  })\n                  .catch((err) => props?.onError?.(err));\n              }}\n              className=\"btn-danger\"\n            >\n              Supprimer\n            </Staff.Button>\n\n            <Button onClick={() => setEdit(false)} className=\"ms-1 btn-round\" title=\"Annuler\">\n              x\n            </Button>\n          </div>\n        </div>\n      )}\n      className={props.className}\n    >\n      <CartDiscountListItem item={item} />\n    </DoubleClickToEdit>\n  );\n};\n\nexport const CartDiscountListItem = ({ item }: { item: TDiscount }) => (\n  <>\n    <span className=\"discount-item-description\">{item.description.slice(0, 30)}</span>\n    <span className=\"discount-item-price d-flex color-green-500\">\n      {`-`}\n      <ProductPriceDisplay retail_price_data={item.amt_data} />\n    </span>\n  </>\n);\n"],"names":["timeout","CartService","this","data","created","Date","toLocaleDateString","undefined","day","weekday","month","year","products","length","post","_path","values","discountSlug","delete","prodSlug","itemSlug","StaffService","Cart","getStaffModel","CartPayView","React","CartUpdateView","useDocumentTitle","cartSlug","useParams","ctx","SharedDataCtx","cart_data","navigate","useNavigate","slug","isLoaded","cart","is_placed","onUpdate","r","updateKey","onSuccess","title","text","actions","className","instance","to","back","headerCN","border","CustomerCard","customer_data","footer","label","amount","subtotal","discounts","map","d","item","bold","total","items","i","size","size_data","cartInstance","updateData","uuid","onClick","place","then","catch","err","console","log","disabled","ProductAddForm","onItemClick","form","useForm","quantity","sizes","cover_data","name","context","onSubmit","e","preventDefault","handleError","header","style","minWidth","maxWidth","src","truncateStr","required","filter","error","errors","max","find","min","CartDiscountAddButton","props","description","amt","onError","canAddDiscount","close","setOpen","setValues","modal","width","bodyCN","renderHeader","renderFooter","postDiscount","render","placeholder","minLength","maxLength","step","type","CartDiscountDeleteListItem","editView","setEdit","slice","destroyDiscount","CartDiscountListItem","retail_price_data","amt_data"],"sourceRoot":""}