{"version":3,"file":"static/js/846.5b09f616.chunk.js","mappings":"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","sources":["../../../../shopy/shopy-salejs/src/cart/utils.ts","../../../../shopy/shopy-salejs/src/cart/views.Update.tsx"],"sourcesContent":["import { getStaffModel, StaffService } from '@miq/staffjs';\nimport { TPriceData, TProductSize } from '@shopy/storejs';\n\nimport { TCustomer } from '../customer';\n\nconst timeout = 5000;\n\nexport type TAPIOrderItem = {\n  slug: string;\n  product: {\n    // slug: string;\n    meta_slug: string;\n    name: string;\n    name_truncated: string;\n    cover: string;\n    cover_data: {\n      src: string;\n      src_mobile: string;\n      thumb: string;\n      thumb_sq: string;\n      alt_text: string;\n      caption: string;\n    };\n    price: TPriceData;\n    retail_price: string;\n    retail_price_data: TPriceData;\n    sale_price: string;\n    sale_price_data: TPriceData;\n    is_on_sale: boolean;\n    is_oos: boolean;\n  };\n  size: string;\n  size_data: TProductSize;\n  quantity: number;\n};\n\nexport type TAPICart = {\n  slug?: string;\n  customer?: string;\n  customer_name?: string;\n  products?: string[];\n  items?: TAPIOrderItem[];\n};\n\nexport type TOrderItem = Record<string, any> & {\n  order?: string;\n  product?: string;\n  product_data?: any;\n  name?: string;\n  price?: string;\n  size?: string;\n  was_sale?: boolean;\n  img?: string;\n  quantity?: number;\n};\n\nexport type TCart = {\n  slug?: string;\n  customer?: string;\n  customer_name?: string;\n  customer_data?: TCustomer;\n  notes?: string;\n  is_paid?: boolean;\n\n  dt_delivery?: string;\n  items?: TOrderItem[];\n  products?: string[];\n\n  is_placed?: boolean;\n  subtotal?: TPriceData;\n  total?: TPriceData;\n\n  created?: string;\n  updated?: string;\n};\n\nclass CartService extends StaffService<TCart> {\n  get createdDt() {\n    return this.data?.created\n      ? new Date(this.data.created!).toLocaleDateString(undefined, {\n          day: '2-digit',\n          weekday: 'short',\n          month: 'short',\n          year: '2-digit',\n        })\n      : null;\n  }\n\n  get canDestroy(): boolean {\n    return this?.data?.products?.length === 0;\n  }\n\n  mark_paid() {\n    return this.post(`${this._path}pay/`, {}, { timeout });\n  }\n\n  place() {\n    return this.post(`${this._path}place/`, {}, { timeout });\n  }\n\n  addItems(values: { size: string; quantity: number; product_slug: string }[]) {\n    return this.post(`${this._path}products/`, values);\n  }\n\n  addItem(prodSlug: string, values: { size: string; quantity: number }) {\n    return this.post(`${this._path}product/${prodSlug}/`, values);\n  }\n\n  updateItem(prodSlug: string, values: Record<string, any>) {\n    return this.post(`${this._path}item/${prodSlug}/`, { ...values }, { timeout });\n  }\n\n  destroyItem(itemSlug: string) {\n    return this.delete(`${this._path}item/${itemSlug}/`, { timeout });\n  }\n}\n\nexport const Cart = getStaffModel<TCart, CartService>('carts', CartService);\n\nexport type TCartInstance = ReturnType<typeof Cart>;\n","import * as React from 'react';\nimport { Link, useNavigate, useParams } from 'react-router-dom';\n\nimport Staff from '@miq/staffjs';\nimport Form, { useForm } from '@miq/formjs';\nimport { useDocumentTitle } from '@miq/hookjs';\nimport { truncateStr, uuid } from '@miq/utiljs';\nimport { Button, Icons, Loading } from '@miq/componentjs';\nimport { SizeQuantityField, SizeSelectField, TProduct, ProductPriceDisplay } from '@shopy/storejs';\n\nimport { TCart, Cart } from './utils';\nimport { CustomerCard } from '../customer';\nimport { ItemProductCard } from './components';\nimport { SharedDataCtx } from '@miq/contextjs';\nimport { CartItemDeleteButton } from './buttons';\n\nconst CartPayView = React.lazy(() => import('./views.UpdatePay'));\n\nexport default function CartUpdateView() {\n  useDocumentTitle('Place cart - Sales');\n  const { cartSlug } = useParams();\n\n  const ctx = React.useContext(SharedDataCtx);\n  const { cart_data } = ctx;\n\n  const navigate = useNavigate();\n\n  if (cartSlug !== cart_data?.slug || !ctx.isLoaded) return <Loading />;\n\n  const cart = Cart(cart_data || {});\n\n  if (cart?.is_placed)\n    return (\n      <CartPayView\n        cart={cart}\n        onSuccess={() => {\n          navigate('../');\n        }}\n      />\n    );\n\n  return (\n    <Staff.View\n      title=\"Panier\"\n      text=\"Verifiez les informations du client et du panier avant de confirmer. Un panier sans produits ne peut pas être confirmé.\"\n      actions={\n        <>\n          <Link\n            to={`/staff/sales/carts/${cart?.slug}/items/`}\n            className=\"btn-primary-3 btn-round\"\n            title=\"Ajouter des produits\"\n          >\n            <Icons.CartPlus />\n          </Link>\n        </>\n      }\n      back=\"/staff/sales/carts\"\n      headerCN=\"miq-container center\"\n    >\n      {/* <pre>{JSON.stringify(cart.export(), null, 2)}</pre> */}\n\n      <div className=\"miq-container center\">\n        <Staff.Section border title=\"Client\">\n          <CustomerCard data={cart.customer_data!} />\n        </Staff.Section>\n\n        <Staff.Section\n          border\n          title={`Panier (${cart?.products?.length} produits)`}\n          footer={\n            <div className=\"\">\n              <div className=\"d-flex justify-content-between\">\n                <span className=\"\">Subtotal</span>\n                <span>\n                  <ProductPriceDisplay retail_price_data={cart?.subtotal} />\n                </span>\n              </div>\n              <div className=\"d-flex justify-content-between\">\n                <span className=\"\">Total</span>\n                <span className=\"fw-bold\">\n                  <ProductPriceDisplay retail_price_data={cart?.subtotal} />\n                </span>\n              </div>\n            </div>\n          }\n        >\n          {cart && cart?.items?.length > 0 ? (\n            <>\n              {cart.items?.map((i) => {\n                // console.log(i);\n\n                return (\n                  <div key={uuid()} className=\"d-flex justify-content-between align-items-center\">\n                    <ItemProductCard {...i} size={i.size_data} />\n                    <div>\n                      <CartItemDeleteButton\n                        cartInstance={cart}\n                        itemSlug={i?.slug}\n                        onSuccess={(r) => {\n                          ctx.updateData({ cart_data: r.data });\n                          // setRes(r);\n                        }}\n                      />\n                    </div>\n                  </div>\n                );\n              })}\n            </>\n          ) : (\n            <>Ajouter</>\n          )}\n        </Staff.Section>\n\n        <div className=\"text-center\">\n          <Button\n            onClick={() => {\n              cart\n                .place()\n                .then((r) => {\n                  ctx.updateData({ cart_data: r.data });\n                })\n                .catch((err) => console.log(err));\n            }}\n            disabled={cart?.products?.length <= 0}\n            className=\"btn-primary btn-md fw-bold w-50\"\n          >\n            Confirmer\n          </Button>\n        </div>\n      </div>\n    </Staff.View>\n  );\n}\n\nexport const ProductAddForm = ({\n  item,\n  onItemClick,\n  ...props\n}: {\n  item: TProduct;\n  onItemClick: (p: TProduct, size: string, qty: string) => Promise<TCart>;\n}) => {\n  const form = useForm({ quantity: 1, size: '' });\n\n  if (!item?.slug) return null;\n\n  const { sizes = [], cover_data, name } = item;\n\n  return (\n    <Form\n      context={form}\n      onSubmit={(e) => {\n        e.preventDefault();\n        onItemClick(item, form.values.size, form.values.quantity).catch((err) => {\n          form.handleError(err);\n        });\n      }}\n    >\n      <Staff.Section\n        border\n        header={\n          <div className=\"d-flex\">\n            <div style={{ minWidth: 34, maxWidth: 50 }} className=\"me-1\">\n              <Staff.Img.Thumb src=\"src\" {...cover_data} className=\"rounded\" />\n            </div>\n\n            <div className=\"flex-1\" title={name}>\n              <div className=\"text-ellipsis text-sm\">\n                <span className=\"me-1 fw-bold\">{truncateStr(name!, 0, 45)}</span>\n              </div>\n\n              <div className=\"d-flex flex-column flex-md-ro justify-content-between\">\n                <div className=\"d-grid grid-md-2 gap-1 flex-1\">\n                  <SizeSelectField required sizes={sizes.filter((i) => i.quantity > 0)} error={form.errors.size} />\n                  <SizeQuantityField max={sizes.find((i) => i.slug === form.values.size)?.quantity || 0} min={1} />\n                </div>\n                <div className=\"text-right\">\n                  <Form.Submit className=\"btn btn-primary-2 btn-md fw-bold\">Ajouter</Form.Submit>\n                </div>\n              </div>\n            </div>\n          </div>\n        }\n        actions={<ProductPriceDisplay {...item} className=\"d-flex flex-wrap\" />}\n        className=\"mb-1\"\n      ></Staff.Section>\n    </Form>\n  );\n};\n"],"names":["timeout","CartService","this","data","created","Date","toLocaleDateString","undefined","day","weekday","month","year","products","length","post","_path","values","prodSlug","itemSlug","delete","StaffService","Cart","getStaffModel","CartPayView","React","CartUpdateView","useDocumentTitle","cartSlug","useParams","ctx","SharedDataCtx","cart_data","navigate","useNavigate","slug","isLoaded","cart","is_placed","onSuccess","title","text","actions","to","className","back","headerCN","border","CustomerCard","customer_data","footer","retail_price_data","subtotal","items","map","i","size","size_data","cartInstance","r","updateData","uuid","onClick","place","then","catch","err","console","log","disabled","ProductAddForm","item","onItemClick","form","useForm","quantity","sizes","cover_data","name","context","onSubmit","e","preventDefault","handleError","header","style","minWidth","maxWidth","src","truncateStr","required","filter","error","errors","max","find","min"],"sourceRoot":""}