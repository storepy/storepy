{"version":3,"file":"static/js/846.ed818fa3.chunk.js","mappings":"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","sources":["../../../../shopy/shopy-salejs/src/cart/components.tsx","../../../../shopy/shopy-salejs/src/cart/utils.ts","../../../../shopy/shopy-salejs/src/cart/views.Update.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport Staff from '@miq/staffjs';\nimport { truncateStr } from '@miq/utiljs';\nimport { ProductPriceDisplay, TProduct, TProductSize } from '@shopy/storejs';\n\nexport const ItemProductCard = ({ product, size }: { product: TProduct; size: TProductSize }) => (\n  <div className=\"d-flex align-items-center\">\n    <ProductImage {...{ product, width: 60, height: 60 }} />\n    <div className=\"flex-1 rounded p-1 \">\n      <div className=\"fw-bold\">{truncateStr(product?.name, 0, 25)}</div>\n      <ProductPriceDisplay {...product} inline />\n      {size && (\n        <div>\n          <span className=\"me-1\">Size:</span>\n          <span className=\"text-sm\">{size?.name}</span>\n        </div>\n      )}\n    </div>\n  </div>\n);\n\nexport const ProductImage = ({\n  product,\n  width,\n  height,\n  ...props\n}: {\n  product: TProduct;\n  width?: number | string;\n  height?: number | string;\n}) =>\n  product?.slug || product.meta_slug ? (\n    <div {...props} style={{ width: width, height: height }}>\n      <Staff.Img.Square slug=\"slug\" src=\"src\" {...product.cover_data} className=\"rounded\" />\n    </div>\n  ) : null;\n","import { getStaffModel, StaffService } from '@miq/staffjs';\nimport { TPriceData, TProductSize } from '@shopy/storejs';\n\nimport { TCustomer } from '../customer';\n\nconst timeout = 5000;\n\nexport type TAPIOrderItem = {\n  slug: string;\n  product: {\n    // slug: string;\n    meta_slug: string;\n    name: string;\n    name_truncated: string;\n    cover: string;\n    cover_data: {\n      src: string;\n      src_mobile: string;\n      thumb: string;\n      thumb_sq: string;\n      alt_text: string;\n      caption: string;\n    };\n    price: TPriceData;\n    retail_price: string;\n    retail_price_data: TPriceData;\n    sale_price: string;\n    sale_price_data: TPriceData;\n    is_on_sale: boolean;\n    is_oos: boolean;\n  };\n  size: string;\n  size_data: TProductSize;\n  quantity: number;\n};\n\nexport type TAPICart = {\n  slug?: string;\n  customer?: string;\n  customer_name?: string;\n  products?: string[];\n  items?: TAPIOrderItem[];\n};\n\nexport type TOrderItem = Record<string, any> & {\n  order?: string;\n  product?: string;\n  product_data?: any;\n  name?: string;\n  price?: string;\n  size?: string;\n  was_sale?: boolean;\n  img?: string;\n  quantity?: number;\n};\n\nexport type TCart = {\n  slug?: string;\n  customer?: string;\n  customer_name?: string;\n  customer_data?: TCustomer;\n  notes?: string;\n  is_paid?: boolean;\n\n  dt_delivery?: string;\n  items?: TOrderItem[];\n  products?: string[];\n\n  is_placed?: boolean;\n  subtotal?: TPriceData;\n  total?: TPriceData;\n\n  created?: string;\n  updated?: string;\n};\n\nclass CartService extends StaffService<TCart> {\n  get createdDt() {\n    return this.data?.created\n      ? new Date(this.data.created!).toLocaleDateString(undefined, {\n          day: '2-digit',\n          weekday: 'short',\n          month: 'short',\n          year: '2-digit',\n        })\n      : null;\n  }\n\n  get canDestroy(): boolean {\n    return this?.data?.products?.length === 0;\n  }\n\n  place() {\n    return this.post(`${this._path}place/`, {}, { timeout });\n  }\n\n  addItems(values: { size: string; quantity: number; product_slug: string }[]) {\n    return this.post(`${this._path}products/`, values);\n  }\n\n  addItem(prodSlug: string, values: { size: string; quantity: number }) {\n    return this.post(`${this._path}product/${prodSlug}/`, values);\n  }\n\n  updateItem(prodSlug: string, values: Record<string, any>) {\n    return this.post(`${this._path}item/${prodSlug}/`, { ...values }, { timeout });\n  }\n\n  destroyItem(itemSlug: string) {\n    return this.delete(`${this._path}item/${itemSlug}/`, { timeout });\n  }\n}\n\nexport const Cart = getStaffModel<TCart, CartService>('carts', CartService);\n\nexport type TCartInstance = ReturnType<typeof Cart>;\n","import * as React from 'react';\nimport { Link, useParams } from 'react-router-dom';\n\nimport Staff from '@miq/staffjs';\nimport { Response, useDocumentTitle, useRequest } from '@miq/hookjs';\nimport { Button, Icons, Loading } from '@miq/componentjs';\nimport Form, { useForm } from '@miq/formjs';\nimport { truncateStr, uuid } from '@miq/utiljs';\nimport { SizeQuantityField, SizeSelectField, TProduct, ProductPriceDisplay } from '@shopy/storejs';\n\nimport { TCart, Cart } from './utils';\nimport { ItemProductCard } from './components';\nimport CartAddItemView from './views.AddItem';\nimport { CartItemDeleteButton } from './buttons';\nimport { CustomerCard } from '../customer';\nimport { SharedDataCtx } from '@miq/contextjs';\n\nconst CartPayView = React.lazy(() => import('./views.UpdatePay'));\n\nexport default function CartUpdateView() {\n  useDocumentTitle('Place cart - Sales');\n  const { cartSlug } = useParams();\n\n  // const { res, setRes, loading } = useRequest(() => Cart({ slug: cartSlug }).retrieve(), {\n  //   refreshDeps: [cartSlug],\n  //   // onSuccess: ({ data }) => form.setValues(mapData2Values(data)),\n  //   onError: ({ response }) => {\n  //     // if (response?.status === 404) return navigate('../');\n  //   },\n  // });\n\n  const ctx = React.useContext(SharedDataCtx);\n  const { cart: cartData, reload } = ctx;\n\n  React.useEffect(() => {\n    reload();\n  }, [cartSlug]);\n\n  if (cartSlug !== cartData?.slug || !ctx.isLoaded) return <Loading />;\n\n  const cart = Cart(cartData || {});\n\n  if (cart?.is_placed) return <CartPayView cart={cart} />;\n\n  return (\n    <Staff.View\n      title=\"Panier\"\n      actions={\n        <>\n          <Link\n            to={`/staff/sales/carts/${cart?.slug}/items/`}\n            className=\"btn-primary-3 btn-round\"\n            title=\"Ajouter des produits\"\n          >\n            <Icons.CartPlus />\n          </Link>\n        </>\n      }\n      back=\"/staff/sales/carts\"\n      headerCN=\"miq-container center\"\n    >\n      {/* <pre>{JSON.stringify(cart.export(), null, 2)}</pre> */}\n\n      <div className=\"miq-container center\">\n        <Staff.Section\n          border\n          title={`Panier (${cart?.products?.length} produits)`}\n          footer={\n            <div className=\"\">\n              <div className=\"d-flex justify-content-between\">\n                <span className=\"\">Subtotal</span>\n                <span>\n                  <ProductPriceDisplay retail_price_data={cart?.subtotal} />\n                </span>\n              </div>\n              <div className=\"d-flex justify-content-between\">\n                <span className=\"\">Total</span>\n                <span className=\"fw-bold\">\n                  <ProductPriceDisplay retail_price_data={cart?.subtotal} />\n                </span>\n              </div>\n            </div>\n          }\n        >\n          {cart && cart?.items?.length > 0 ? (\n            <>\n              {cart.items?.map((i) => {\n                // console.log(i);\n\n                return (\n                  <div key={uuid()} className=\"d-flex justify-content-between align-items-center\">\n                    <ItemProductCard {...i} size={i.size_data} />\n                    <div>\n                      <CartItemDeleteButton\n                        cartInstance={cart}\n                        itemSlug={i?.slug}\n                        onSuccess={(r) => {\n                          ctx.updateData({ cart: r.data });\n                          // setRes(r);\n                        }}\n                      />\n                    </div>\n                  </div>\n                );\n              })}\n            </>\n          ) : (\n            <>Ajouter</>\n          )}\n        </Staff.Section>\n\n        <Staff.Section border title=\"Client\">\n          <CustomerCard data={cart.customer_data!} />\n        </Staff.Section>\n\n        <div className=\"text-center\">\n          <Button\n            onClick={() => {\n              cart\n                .place()\n                .then((r) => {\n                  // setRes(r);\n                  ctx.updateData({ cart: r.data });\n                })\n                .catch((err) => console.log(err));\n            }}\n            disabled={cart?.products?.length <= 0}\n            className=\"btn-primary btn-md fw-bold w-50\"\n          >\n            Confirmer\n          </Button>\n        </div>\n      </div>\n    </Staff.View>\n  );\n}\n\nexport const ProductAddForm = ({\n  item,\n  onItemClick,\n  ...props\n}: {\n  item: TProduct;\n  onItemClick: (p: TProduct, size: string, qty: string) => Promise<TCart>;\n}) => {\n  const form = useForm({ quantity: 1, size: '' });\n\n  if (!item?.slug) return null;\n\n  const { sizes = [], is_oos, cover_data, name, size_count = 0 } = item;\n\n  const canAdd = !is_oos && size_count > 0;\n\n  return (\n    <Form\n      context={form}\n      onSubmit={(e) => {\n        e.preventDefault();\n        onItemClick(item, form.values.size, form.values.quantity).catch((err) => {\n          form.handleError(err);\n        });\n      }}\n    >\n      <Staff.Section\n        border\n        header={\n          <div className=\"d-flex\">\n            <div style={{ minWidth: 34, maxWidth: 50 }} className=\"me-1\">\n              <Staff.Img.Thumb src=\"src\" {...cover_data} className=\"rounded\" />\n            </div>\n\n            <div className=\"flex-1\" title={name}>\n              <div className=\"text-ellipsis text-sm\">\n                <span className=\"me-1 fw-bold\">{truncateStr(name!, 0, 45)}</span>\n              </div>\n\n              <div className=\"d-flex flex-column flex-md-ro justify-content-between\">\n                <div className=\"d-grid grid-md-2 gap-1 flex-1\">\n                  <SizeSelectField required sizes={sizes.filter((i) => i.quantity > 0)} error={form.errors.size} />\n                  <SizeQuantityField max={sizes.find((i) => i.slug === form.values.size)?.quantity || 0} min={1} />\n                </div>\n                <div className=\"text-right\">\n                  <Form.Submit className=\"btn btn-primary-2 btn-md fw-bold\">Ajouter</Form.Submit>\n                </div>\n              </div>\n            </div>\n          </div>\n        }\n        actions={<ProductPriceDisplay {...item} className=\"d-flex flex-wrap\" />}\n        className=\"mb-1\"\n      ></Staff.Section>\n    </Form>\n  );\n};\n"],"names":["ItemProductCard","product","size","className","ProductImage","width","height","truncateStr","name","inline","props","slug","meta_slug","style","src","cover_data","timeout","CartService","this","data","created","Date","toLocaleDateString","undefined","day","weekday","month","year","products","length","post","_path","values","prodSlug","itemSlug","delete","StaffService","Cart","getStaffModel","CartPayView","React","CartUpdateView","useDocumentTitle","cartSlug","useParams","ctx","SharedDataCtx","cartData","cart","reload","isLoaded","is_placed","title","actions","to","back","headerCN","border","footer","retail_price_data","subtotal","items","map","i","size_data","cartInstance","onSuccess","r","updateData","uuid","CustomerCard","customer_data","onClick","place","then","catch","err","console","log","disabled","ProductAddForm","item","onItemClick","form","useForm","quantity","sizes","is_oos","size_count","context","onSubmit","e","preventDefault","handleError","header","minWidth","maxWidth","required","filter","error","errors","max","find","min"],"sourceRoot":""}